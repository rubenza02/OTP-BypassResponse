<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>OTP Minimal Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root { color-scheme: dark; }
    body { font-family: system-ui, Arial, sans-serif; background:#0e0f12; color:#e8e8ea; margin:0; padding:32px; display:flex; justify-content:center; }
    .card { width: 100%; max-width: 520px; background:#15171c; border:1px solid #2a2d34; border-radius:12px; padding:20px; box-shadow:0 6px 24px rgba(0,0,0,.25);}
    h1 { margin: 0 0 12px 0; font-size: 22px; }
    p.hint { margin: 0 0 16px 0; color:#ff7676; }
    label { display:block; margin:12px 0 6px; font-size: 14px; color:#c8c9cc; }
    input { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #333842; background:#0f1116; color:#e8e8ea; }
    button { margin-top:16px; width:100%; padding:12px 14px; border-radius:8px; border:1px solid #3a86ff33; background:#3a86ff22; color:#dbe6ff; cursor:pointer; font-weight:600; }
    button:active { transform: translateY(1px); }
    .result { margin-top:16px; padding:12px; border-radius:8px; background:#101216; border:1px dashed #2b2f36; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; white-space: pre-wrap; }
    .muted { color:#9aa0a6; font-size: 12px; margin-top:6px;}
  </style>
</head>
<body>
  <div class="card">
    <h1>OTP Minimal Lab</h1>
    <p class="hint">Solo laboratorio local. OTP válido inicial: <code>alice / 123456</code></p>

    <form id="otp-form">
      <label for="user">User</label>
      <input id="user" name="user" placeholder="alice" value="alice" autocomplete="off"/>

      <label for="otp">OTP</label>
      <input id="otp" name="otp" placeholder="123456" value="123456" autocomplete="one-time-code" inputmode="numeric"/>

      <button id="send-btn" type="submit">Enviar</button>
    </form>

    <div id="output" class="result">Pulsa “Enviar” para probar.</div>
    <div class="muted">La petición va a <code>/api/verify_otp</code>. Se muestra el <strong>status</strong> y el <strong>body</strong>.</div>
  </div>

<script>
(() => {
  const form = document.getElementById('otp-form');
  const output = document.getElementById('output');

  form.addEventListener('submit', async (ev) => {
    ev.preventDefault();
    const user = document.getElementById('user').value.trim();
    const otp  = document.getElementById('otp').value.trim();

    output.textContent = 'Enviando...';

    try {
      const resp = await fetch('/api/verify_otp', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ user, otp })
      });

      const status = resp.status;
      let bodyText;
      try {
        const data = await resp.json();
        bodyText = JSON.stringify(data, null, 2);
      } catch {
        bodyText = await resp.text();
      }
      output.textContent = `HTTP ${status}\n\n${bodyText}`;
    } catch (err) {
      output.textContent = `Error de red o JS:\n${String(err)}`;
    }
  });
})();
</script>
</body>
</html>
